<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>{{title}} — ZAKKI</title>
  <meta name="description" content="{{description}}" />
  <meta name="author" content="ZAKI" />

  <!-- OG/Twitter（JSで{{}}を埋めます） -->
  <meta property="og:title" content="{{title}} — ZAKKI" />
  <meta property="og:description" content="{{description}}" />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="{{url}}" />
  <meta property="og:site_name" content="ZAKKI" />
  <meta property="og:image" content="/ogimages/{{slug}}.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{title}} — ZAKKI" />
  <meta name="twitter:description" content="{{description}}" />
  <meta name="twitter:image" content="/ogimages/{{slug}}.png" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Audiowide&family=Inter:wght@400;600;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet" />
  <link rel="icon" type="image/png" href="/favicon.png" />

  <style>
    /* ====== Tokens (Neon Noire) ====== */
    :root{
      --bg-1:#1a0f1f;  /* 暗い紫 */
      --bg-2:#0f1b2e;  /* 群青 */
      --fg:#f5f7ff;    /* 本文 */
      --muted:#b6bcd3; /* 補助 */
      --accent:#18e0ff;       /* シアン */
      --accent-warm:#ffa62b;  /* オレンジ */
      --card:rgba(18,20,36,0.78);
      --border:#2b3658;
      --shadow:0 18px 40px rgba(0,0,0,.5);
      --radius:16px; --radius-sm:12px; --maxw:860px;
      --code-bg:#0c1f3f; --code-bd:#2a4b7f;
      --chip-research:#8bb6ff; --chip-creative:#f2a65a; --chip-bridge:#9fd3c7; --chip-career:#c8a1ff; --chip-misc:#a7bfdc;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; font-family:Inter, "Noto Sans JP", system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif; color:var(--fg);
      background:linear-gradient(180deg,var(--bg-1) 0%, var(--bg-2) 100%);
      background-attachment:fixed; line-height:1.85; letter-spacing:.2px}
    a{color:var(--accent); text-decoration:none} a:hover{text-decoration:underline}

    /* ====== Header / Crumbs ====== */
    header{position:sticky; top:0; z-index:10; backdrop-filter:blur(10px);
      background:linear-gradient(180deg, rgba(10,10,22,.75), rgba(10,10,22,.4)); border-bottom:1px solid rgba(255,255,255,.08)}
    .wrap{max-width:var(--maxw); margin:0 auto; padding:0 20px}
    .nav{display:flex; align-items:center; justify-content:space-between; padding:14px 0}
    .brand{font-family:'Audiowide', sans-serif; letter-spacing:.06em; font-size:20px}
    .crumbs{font-size:13px; color:var(--muted)}
    .crumbs a{color:var(--muted)}

    /* ====== Hero ====== */
    .hero{position:relative; overflow:hidden}
    .hero::before{content:""; position:absolute; inset:0; pointer-events:none; z-index:-1;
      background:radial-gradient(800px 420px at 50% 35%, rgba(255,255,255,.08) 0%, transparent 70%)}
    .title{font-family:'Audiowide', sans-serif; font-weight:400; font-size:clamp(28px, 6.5vw, 58px); line-height:1.05; margin:12px 0 6px; letter-spacing:.06em; color:var(--accent-warm);
      text-shadow:0 0 22px rgba(255,166,43,.28), 0 3px 0 rgba(0,0,0,.45)}
    .subtitle{margin:6px 0 0; font-family:Inter, "Noto Sans JP", sans-serif; font-weight:400; font-size:clamp(14px, 2.6vw, 16px); letter-spacing:.05em; color:var(--muted)}

    .meta{display:flex; gap:12px; flex-wrap:wrap; align-items:center; color:var(--muted); font-size:13px; margin-top:8px}
    .chips{display:flex; gap:8px; flex-wrap:wrap}
    .chip{padding:6px 10px; border-radius:999px; font-size:12px; font-weight:600; background:rgba(255,255,255,.04); border:1px solid currentColor; color:currentColor}
    .chip[data-t="research"]{color:var(--chip-research)}
    .chip[data-t="creative"]{color:var(--chip-creative)}
    .chip[data-t="bridge"]{color:var(--chip-bridge)}
    .chip[data-t="career"]{color:var(--chip-career)}
    .chip[data-t="misc"]{color:var(--chip-misc)}

    /* ====== Article ====== */
    article{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); box-shadow:var(--shadow); padding:22px; margin:18px 0 28px}
    article h2{font-size:24px; margin:26px 0 10px; color:#eaf1ff; font-weight:600}
    article h3{font-size:18px; margin:20px 0 8px; color:#eaf1ff; font-weight:600}
    article p{margin:.8em 0}
    article ul, article ol{padding-left:1.5em}
    blockquote{margin:14px 0; padding:10px 14px; border-left:3px solid var(--accent); background:rgba(255,255,255,.06); border-radius:0 var(--radius-sm) var(--radius-sm) 0}

    figure{margin:16px 0}
    figure img{max-width:100%; border-radius:12px; border:1px solid var(--border); box-shadow:var(--shadow)}
    figcaption{font-size:13px; color:var(--muted); margin-top:6px}

    .tablewrap{overflow:auto; border:1px solid var(--border); border-radius:12px; margin:12px 0}
    table{width:100%; border-collapse:collapse; min-width:560px}
    th,td{padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.08)}
    thead th{background:rgba(255,255,255,.06); text-align:left}

    pre{background:var(--code-bg); border:1px solid var(--code-bd); border-radius:12px; padding:14px; overflow:auto; position:relative}
    code{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
    .copy{position:absolute; top:8px; right:8px; font-size:12px; background:rgba(255,255,255,.15); border:1px solid rgba(255,255,255,.25); padding:4px 8px; border-radius:8px; cursor:pointer}

    .callout{border:1px solid rgba(255,255,255,.18); background:rgba(255,255,255,.06); border-radius:12px; padding:12px 14px; margin:14px 0}
    .callout.info{border-color:#5f8ec4}
    .callout.warn{border-color:#f2a65a}
    .callout.success{border-color:#76b6a7}

    .toc{background:rgba(255,255,255,.05); border:1px dashed rgba(255,255,255,.18); border-radius:12px; padding:14px; margin:14px 0}
    .toc h3{margin:0 0 8px; font-size:14px; color:#eaf1ff}
    .toc ul{list-style:none; margin:0; padding:0}
    .toc li{margin:6px 0}

    .post-end{display:grid; gap:16px}
    @media(min-width:860px){ .post-end{grid-template-columns: 1fr 1fr} }
    .author{display:flex; gap:12px; align-items:flex-start; background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.15); border-radius:12px; padding:14px}
    .avatar{width:56px; height:56px; border-radius:999px; background:linear-gradient(135deg, #18e0ff, #0f1b2e); border:2px solid rgba(255,255,255,.2); display:flex; align-items:center; justify-content:center; font-weight:800}
    .share{background:rgba(255,255,255,.05); border:1px solid rgba(255,255,255,.15); border-radius:12px; padding:14px}
    .share a{margin-right:10px}

    footer{margin:22px 0 40px; color:var(--muted); font-size:13px; text-align:center}
  </style>
</head>
<body>
  <header>
    <div class="wrap nav">
      <div class="brand"><a href="/" style="color:var(--fg); text-decoration:none">ZAKKI</a></div>
      <nav class="crumbs">
        <a href="/">Home</a> ／ <a href="/categories/{{category}}">{{categoryLabel}}</a> ／ <span>{{title}}</span>
      </nav>
    </div>
  </header>

  <main class="wrap">
    <!-- Hero -->
    <section class="hero" style="padding:28px 0 8px">
      <h1 class="title">{{title}}</h1>
      <h2 class="subtitle">{{subtitle}}</h2>
      <div class="meta">
        <span>🗓 {{date}}</span>
        <span>·</span>
        <span>⏱ 読了目安：{{readingTime}}分</span>
        <span>·</span>
        <span class="chip" data-t="{{category}}">{{categoryLabel}}</span>
        <div class="chips">
          <span class="chip" data-t="research">{{tag1}}</span>
          <span class="chip" data-t="misc">{{tag2}}</span>
        </div>
      </div>
    </section>

    <!-- TOC -->
    <aside class="toc" id="toc">
      <h3>目次</h3>
      <ul></ul>
    </aside>

    <!-- Article -->
    <article id="post">
      <h2>はじめに</h2>
      <p>この記事では、{{shortIntro}}。</p>

      <h2>背景</h2>
      <p>{{background}}</p>

      <h2>方法 / 手順</h2>
      <p>{{methodsIntro}}</p>
      <ol>
        <li>{{step1}}</li>
        <li>{{step2}}</li>
        <li>{{step3}}</li>
      </ol>

      <h3>コード例</h3>
      <pre><button class="copy" data-target="code-1">copy</button><code id="code-1">python
import numpy as np
print("Hello ZAKKI")
</code></pre>

      <h2>結果 / 考察</h2>
      <p>{{findings}}</p>
      <blockquote>メモ：結論を先に書く → 根拠 → 例 → 余白（次の課題）。</blockquote>

      <figure>
        <img src="{{imageUrl}}" alt="{{imageAlt}}" />
        <figcaption>{{imageCaption}}</figcaption>
      </figure>

      <div class="tablewrap">
        <table>
          <thead>
            <tr><th>項目</th><th>値</th><th>メモ</th></tr>
          </thead>
          <tbody>
            <tr><td>A</td><td>0.82</td><td>例：CV平均R²</td></tr>
            <tr><td>B</td><td>±0.04</td><td>例：標準偏差</td></tr>
          </tbody>
        </table>
      </div>

      <h2>まとめ</h2>
      <ul>
        <li>{{summary1}}</li>
        <li>{{summary2}}</li>
        <li>{{summary3}}</li>
      </ul>

      <div class="callout info">💡 次に読む：<a href="{{related1url}}">{{related1}}</a></div>
      <div class="callout warn">⚠ 注意点：{{caution}}</div>
      <div class="callout success">✅ ダウンロード：<a href="{{assetUrl}}">{{assetName}}</a></div>
    </article>

    <!-- Post end -->
    <section class="post-end">
      <div class="author">
        <div class="avatar" aria-hidden="true">ZK</div>
        <div>
          <strong>ZAKI</strong>
          <p class="muted">京都大学大学院／神経変性疾患の医用画像解析（NDM/ESM/SuStaIn）。U26女子ブリッジ日本代表。創作はマダミス/RPG/ロゴなど。</p>
          <p><a href="/about">もっと見る →</a></p>
        </div>
      </div>
      <div class="share">
        <strong>Share</strong>
        <p>
          <a href="https://twitter.com/intent/tweet?text={{title}}&url={{url}}" target="_blank" rel="noopener">Xに共有</a>
          <a href="https://b.hatena.ne.jp/add?mode=confirm&url={{url}}&title={{title}}" target="_blank" rel="noopener">はてブ</a>
          <a href="mailto:?subject={{title}}&body={{url}}">メール</a>
        </p>
      </div>
    </section>

    <footer>
      <p>© 2025 ZAKKI — <a href="/">トップへ戻る</a></p>
    </footer>
  </main>

  <script>
    // ---- プレーンHTMLでも動く簡易{{}}置換 ----
    const POST = {
      title: 'Network Diffusion Modelでみるパーキンソン病の萎縮進行',
      description: '脳ネットワーク上の拡散モデルでPDの萎縮パターンを読む実験メモ',
      url: window.location.href,
      slug: 'ndm-parkinson',
      category: 'research',
      categoryLabel: '研究',
      date: '2025-10-12',
      readingTime: '7',
      subtitle: '拡散定数・結合重み・境界条件の感度を小規模データで検証',
      tag1: 'NDM',
      tag2: 'Neuroimaging',
      shortIntro: 'NDMの前提・実装・評価の要点を整理します',
      background: 'NDMは連結行列に対する熱方程式類似の時間発展を仮定し…',
      methodsIntro: '今回はシンプルなラプラシアン拡散を用い、結合は機能/構造connectomeで…',
      step1: '前処理：Z-score正規化と接続行列のスケーリング',
      step2: 'パラメタ探索：βのグリッドサーチとCV',
      step3: '評価：予測萎縮マップと観測の相関',
      findings: '小標本でもβの安定域が見える。半球非対称に関する追加検討が必要。',
      imageUrl: '/assets/images/sample-ndm.png',
      imageAlt: 'NDMの概念図',
      imageCaption: 'Fig.1 拡散の時間発展イメージ（ダミー）',
      summary1: 'βは0.015〜0.03で指標が安定',
      summary2: '構造connectomeのほうが説明力が高い傾向',
      summary3: '半球差と基底核周辺の例外値は追加分析へ',
      related1: 'ENIGMA toolboxの可視化：罠と回避メモ',
      related1url: '/article/enigma-visualization.html',
      caution: '患者/対照の年齢分布を完全一致させていないため、交絡の可能性あり',
      assetUrl: '/assets/files/ndm-notes.pdf',
      assetName: '補足PDF（実験メモ）'
    };

    function replacePlaceholders(root=document){
      const walker = document.createTreeWalker(root, NodeFilter.SHOW_TEXT, null);
      const texts = [];
      while(walker.nextNode()) texts.push(walker.currentNode);
      texts.forEach(node => { node.nodeValue = node.nodeValue.replace(/{{(\w+)}}/g, (_,k)=> POST[k] ?? ''); });
      document.querySelectorAll('meta, link').forEach(el => {
        for(const attr of ['content','href']){
          if(el.hasAttribute(attr)){
            el.setAttribute(attr, el.getAttribute(attr).replace(/{{(\w+)}}/g, (_,k)=> POST[k] ?? ''));
          }
        }
      });
      const cat = document.querySelector('.crumbs a[href^="/categories/"]');
      if(cat) cat.setAttribute('href', `/categories/${POST.category}`);
    }
    replacePlaceholders();

    // ---- TOC 自動生成（h2/h3） ----
    (function(){
      const toc = document.querySelector('#toc ul');
      const headings = document.querySelectorAll('#post h2, #post h3');
      if(!toc || headings.length===0) return;
      headings.forEach(h => {
        if(!h.id){ h.id = h.textContent.trim().replace(/\s+/g,'-').toLowerCase() }
        const li = document.createElement('li');
        li.style.marginLeft = h.tagName==='H3' ? '14px' : '0';
        const a = document.createElement('a'); a.href = `#${h.id}`; a.textContent = h.textContent;
        li.appendChild(a); toc.appendChild(li);
      });
    })();

    // ---- コードコピー ----
    document.addEventListener('click', (e)=>{
      const btn = e.target.closest('.copy'); if(!btn) return;
      const id = btn.getAttribute('data-target');
      const code = document.getElementById(id); if(!code) return;
      const text = code.innerText;
      if(navigator.clipboard){
        navigator.clipboard.writeText(text).then(()=>{ btn.textContent='copied!'; setTimeout(()=>btn.textContent='copy', 1200); });
      } else {
        const ta = document.createElement('textarea'); ta.value = text; document.body.appendChild(ta); ta.select();
        try { document.execCommand('copy'); btn.textContent='copied!'; } catch(_){}
        document.body.removeChild(ta); setTimeout(()=>btn.textContent='copy', 1200);
      }
    });
  </script>
</body>
</html>
